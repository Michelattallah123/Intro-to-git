<%- include("../partials/header") %>
<body id="show-body">
<%- include("../partials/body") %>
<div class="container">

  <div class="movie-data">
        <div class="movie-title">
          <h2><%=movie.Title%></h2>
        </div>
          <p><%=movie.Runtime%> | <%=movie.Genre%> | <%=movie.Released%></p>
          
  </div>
  <div class="movie-media">
        <img src="<%=movie.Poster%>">
        <iframe src="<%=movie.Trailer%>"
        width="560"  height="315" frameborder="0" ></iframe>        
  </div>
  <div class="movie-data">
          <p><%=movie.Plot%></p>
          <hr>
          <p>Director: <%=movie.Director%></p>
          <p>Writers: <%=movie.Writers%></p>
          <p>Cast: <%=movie.Actors%><p>
          <div class="dropdown">
                <a class="btn dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  Review
                </a>
                <div class="dropdown-menu">
                    <form class="px-4 py-3" method="POST" action="/movies/<%=movie.imdbID%>/reviews">
                      <div class="form-group">
                        <h4>My Review</h4>
                        <textarea name="review" id="review" cols="60" rows="10" placeholder="Text..."></textarea>
                      </div>
                      <button type="submit" class="btn btn-primary">Add Review</button>
                    </form>
                </div>
           </div>
  <div class="reviews">
    <h1>Reviews</h1>
    <hr>
    <% for(let i=0;i<movie.Reviews.length;i++){%>
      <div class="oneReview">
    <div class="reviewComment">
        <p>
            <strong><%=movie.Reviews[i].review.author.name%></strong> - <%=moment(movie.Reviews[i].review.date).fromNow()%>
            <%if(currentUser&&(movie.Reviews[i].review.author.username=currentUser.username)){%>
            <div class="dropdown float-right">
              <div class="btn-group dropleft">
                <button class="reviewDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <i class="fas fa-ellipsis-v"></i>
                </button>
                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                    <a class="editReviewButton dropdown-item">Edit</a>
                    <form action="/movies/<%= movie.imdbID %>/reviews/<%=movie.Reviews[i].id%>?_method=DELETE" method="POST" >
                      <button class="submit button deleteReviewButton dropdown-item">Delete</button>
                    </form>
                    </div>
              </div>
          </div>
          <%}%>
        </p>
        <p class="reviewText"><%=movie.Reviews[i].review.text%></p>
        
        <p>
            Rating:<%=movie.Reviews[i].review.rating%>
        </p>
    </div>
  <div class="reviewEdit hide">
    <form action="/movies/<%= movie.imdbID %>/reviews/<%=movie.Reviews[i].id%>?_method=PUT" method="POST">
      <textarea class="editText" name="edit" id="" cols="150" rows="5"></textarea>
      <hr>
      <button type="submit" class="btn btn-primary float-right">SAVE</button>
      <button type="button" class="cancelEditButton btn btn-light float-right">CANCEL</button>
    </form>
    
  </div>
  <hr>
    </div>
    <%}%>
  </div>
  </div> 
</div>
<%- include("../partials/footer") %>